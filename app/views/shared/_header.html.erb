<%= render ModalComponent.new(id: "filter", title: "Filter") do %>
    <form method="get" action="<%= books_path %>" class="flex flex-col gap-4">
        <div>
            <label for="q" class="block font-medium mb-1">Search</label>
            <input type="text" name="q" id="q" value="<%= @q %>" class="w-full border border-gray-300 rounded px-3 py-2">
        </div>
        <div>
            <label for="from_on" class="block font-medium mb-1">From Published Date</label>
            <input type="date" name="from_on" id="from_on" value="<%= @from_on %>" class="w-full border border-gray-300 rounded px-3 py-2">
        </div>
        <div>
            <label for="to_on" class="block font-medium mb-1">To Published Date</label>
            <input type="date" name="to_on" id="to_on" value="<%= @to_on %>" class="w-full border border-gray-300 rounded px-3 py-2">
        </div>
        <div>
            <label for="min_amount" class="block font-medium mb-1">Min Amount</label>
            <input type="number" name="min_amount" id="min_amount" value="<%= @min_amount %>" class="w-full border border-gray-300 rounded px-3 py-2">
        </div>
        <div>
            <label for="max_amount" class="block font-medium mb-1">Max Amount</label>
            <input type="number" name="max_amount" id="max_amount" value="<%= @max_amount %>" class="w-full border border-gray-300 rounded px-3 py-2">
        </div>
        <div>
            <label for="sort" class="block font-medium mb-1">Sort By</label>
            <select name="sort" id="sort" class="w-full border border-gray-300 rounded px-3 py-2">
                <option value="" <%= "selected" if @sort.blank? %>>Default</option>
                <option value="newest" <%= "selected" if @sort == "newest" %>>Newest</option>
                <option value="oldest" <%= "selected" if @sort == "oldest" %>>Oldest</option>
                <option value="amount_asc" <%= "selected" if @sort == "amount_asc" %>>Amount Ascending</option>
                <option value="amount_desc" <%= "selected" if @sort == "amount_desc" %>>Amount Descending</option>
            </select>
        </div>
        <div class="flex justify-end gap-2">
            <button type="button" class="button-gray" onclick="window.dispatchEvent(new CustomEvent('modal:close', { detail: { id: 'filter' } }))">Cancel</button>
            <button type="submit" class="button-blue">Apply</button>
        </div>
    </form>
<% end %>

<header class="min-w-100 flex items-center bg-[#ffe4e1] py-2 px-4">
    <a class="select-none flex items-center" href="<%= root_path %>">
        <%= image_tag "rbl.png", class: "h-10 my-2" %>
        <div class="text-[#933] font-bold text-[1.2rem] leading-none ml-2">
            <span class="text-[1.6rem]">Ruby</span>
            <br>
            <span class="whitespace-nowrap">Library App</span>
        </div>
    </a>
    <!-- TODO:Theme Toggle Button Here -->
    <div data-controller="searchbox" class="ml-auto relative flex items-center justify-center mr-1 w-55 h-11">
        <button data-action="click->searchbox#open" data-searchbox-target="hitbox" class="peer absolute right-0 w-11 h-11 flex items-center justify-center z-10 transition-[transform,opacity] duration-300 bg-black/15 rounded-full opacity-0 hover:opacity-100"></button>
        <div data-action="click->searchbox#focus" data-searchbox-target="background" class="transition-[transform,opacity] duration-300 bg-white opacity-0 rounded-full absolute w-55 h-11"></div>
        <%= image_tag "search.svg", data: { searchbox_target: "icon" }, class: "transition-transform duration-300 w-8 z-1 absolute pointer-events-none left-0 translate-x-43.5 peer-hover:grayscale ml-2" %>
        <%= form_with url: books_path, method: :get, local: true do |f| %>
            <%= f.search_field :q,
                value: params[:q],
                placeholder: "Search...",
                data: {
                    action: "blur->searchbox#checkClose keydown.esc->searchbox#close",
                    searchbox_target: "input"
                },
                class: "focus:outline-0 scale-x-0 transition-transform z-11 pl-10 pr-1 py-2.5" %>
        <% end %>
    </div>
    <div class="w-11 h-11 relative">
        <button onclick="window.dispatchEvent(new CustomEvent('modal:open', { detail: { id: 'filter' } }))" class="w-11 h-11 hover:opacity-100 opacity-0 rounded-full transition-opacity duration-300 flex items-center justify-center bg-black/15 cursor-pointer"></button>
        <%= image_tag "filter_alt.svg", class: "absolute top-0 bottom-0 left-0 right-0 pointer-events-none select-none m-auto h-7" %>
    </div>
    <!-- Buttons -->
    <%= link_to "BOOKS", books_path, class: "ml-2 button-blue" %>
    <% if user_signed_in? %>
        <%= link_to "LOANS", loans_path, class: "ml-2 button-gray" %>
        <%= button_to "Sign out", destroy_user_session_path, method: :delete, class: "ml-2 button-red" if user_signed_in? %>
    <% else %>
        <div class="ml-2">
            <%= link_to "Sign in", new_user_session_path, class: "text-sm rounded-md px-3 py-2 border-2 font-bold" %>
            <!-- TODO:HoverしたらGPUでGrayになるようにOpacity/Peerで組む -->
        </div>
    <% end %>
</header>
